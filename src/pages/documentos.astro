---
import Layout from '../layouts/Layout.astro';
import { ChevronLeftIcon, FolderIcon, DocumentTextIcon } from '@heroicons/react/24/solid';
import SistemaBusquedaDocumentos from '../components/SistemaBusquedaDocumentos';
import fs from 'fs';
import path from 'path';

const baseUrl = import.meta.env.BASE_URL;

// Función para leer documentos de una carpeta
function leerDocumentos(carpeta: string): string[] {
	try {
		const rutaCompleta = path.join(process.cwd(), 'public', 'documentos', carpeta);
		const archivos = fs.readdirSync(rutaCompleta);
		return archivos.filter(archivo => !archivo.startsWith('.') && archivo !== 'README.md');
	} catch (error) {
		return [];
	}
}

// Definir las 4 secciones principales de documentos (áreas del Gabinete Técnico)
const secciones = [
	{
		id: 'materias-estrategicas',
		nombre: 'Control y Gestión de Materias Estratégicas',
		jefe: 'Cristian Rojas Castillo',
		color: 'from-blue-500 to-blue-600',
		documentos: leerDocumentos('materias-estrategicas')
	},
	{
		id: 'cadena-suministros',
		nombre: 'Control y Gestión de Cadena de Suministros',
		jefe: 'Mauricio Avendaño Pinto',
		color: 'from-purple-500 to-purple-600',
		documentos: leerDocumentos('cadena-suministros')
	},
	{
		id: 'infraestructura',
		nombre: 'Control y Gestión de Infraestructura',
		jefe: 'Jorge Gonzalez Olea',
		color: 'from-green-500 to-green-600',
		documentos: leerDocumentos('infraestructura')
	},
	{
		id: 'financiero',
		nombre: 'Control y Gestión Financiero',
		jefe: 'Cesar Salgado',
		color: 'from-orange-500 to-orange-600',
		documentos: leerDocumentos('financiero')
	}
];
---

<Layout>
	<!-- Sección de Documentos -->
	<section class="min-h-screen bg-gradient-to-br from-gray-50 to-white relative overflow-hidden pt-24 pb-16">
		<!-- Botón de regreso -->
		<div class="mx-auto px-8 md:px-8 pt-4 md:pt-8 absolute top-0 left-0 z-10">
			<a 
				href={`${baseUrl}`}
				class="inline-flex items-center gap-2 px-4 py-4 bg-gradient-to-r from-primary-green to-secondary-green text-white font-extrabold rounded-full shadow-lg hover:shadow-xl hover:from-secondary-green hover:to-primary-green transition-all duration-300 hover:scale-105"
			>
				<ChevronLeftIcon className="w-9 h-9 text-white"/>
				<span class="sr-only">Volver al inicio</span>
			</a>
		</div>

		<div class="max-w-[1600px] mx-auto px-4 md:px-8 relative z-10">
			<!-- Encabezado -->
			<div class="text-center mb-12 animate-fade-in-up">
				<div class="text-secondary-green font-semibold text-sm uppercase tracking-[2px] mb-2">
					CENTRO DE DOCUMENTACIÓN
				</div>
				<h1 class="text-4xl md:text-5xl font-extrabold text-text-dark mb-4">
					Repositorio de Documentos
				</h1>
				<p class="text-lg text-slate-600 max-w-3xl mx-auto">
					Acceso centralizado a documentos institucionales organizados por área
				</p>
			</div>

			<!-- Carpetas de áreas -->
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-2 mb-2">
				{secciones.map((seccion, index) => (
					<div 
						class="group bg-white rounded-xl border-2 border-gray-200 p-8 hover:border-primary-green hover:shadow-xl transition-all duration-300 cursor-pointer animate-fade-in-up"
						style={`animation-delay: ${(index + 3) * 100}ms;`}
					>
						<!-- Icono de carpeta estilo Windows -->
						<div class="relative mb-6">
							<div class={`w-24 h-24 mx-auto bg-gradient-to-br ${seccion.color} rounded-lg shadow-lg transform group-hover:scale-110 transition-transform duration-300 flex items-center justify-center`}>
								<FolderIcon className="w-16 h-16 text-white" />
							</div>
						</div>

						<!-- Nombre de la sección -->
						<h3 class="text-xl font-bold text-center text-slate-900 mb-2 group-hover:text-primary-green transition-colors">
							{seccion.nombre}
						</h3>

						<!-- Contador de documentos -->
						<div class="flex items-center justify-center gap-2 text-sm text-slate-600">
							<DocumentTextIcon className="w-4 h-4" />
							<span>{seccion.documentos.length} documento{seccion.documentos.length !== 1 ? 's' : ''}</span>
						</div>

						<!-- Estado vacío -->
						{seccion.documentos.length === 0 && (
							<div class="mt-4 text-center">
								<p class="text-xs text-slate-400 italic">Carpeta vacía</p>
							</div>
						)}
					</div>
				))}
			</div>

			<!-- Sistema de búsqueda y vista general integrado -->
			<SistemaBusquedaDocumentos secciones={secciones} baseUrl={baseUrl} client:load />
		</div>
	</section>
</Layout>

<style>
	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.animate-fade-in-up {
		animation: fadeInUp 0.6s ease forwards;
		opacity: 0;
	}

	.animation-delay-200 {
		animation-delay: 0.2s;
	}

	.animation-delay-700 {
		animation-delay: 0.7s;
	}

	.animation-delay-800 {
		animation-delay: 0.8s;
	}
</style>
